{
  "hash": "2eb246a67fdb337150eb3ec85d7b0ffe",
  "result": {
    "markdown": "---\ntitle: \"Cartography Example\"\ndescription: \"A brief example showing how to use cartography to add a hatched layer to a map.\"\nauthor: \n  - name: Jessica French \n    url: https://jessicafrench.github.io\n    affiliation: MEDS\n    affiliation-url: https://ucsb-meds.github.io/\ndate: 2022-12-20\ncategories: [MEDS]\ncitation: \n  url: https://jessicafrench.github.io/blog_posts/2022-12-20-cartography-example\ndraft: TRUE\n---\n\n\n## Introduction\n\nThe cartography package can be used with base r `plot` to add map elements and improve the legibility of your maps. Hatching can be an effective way to visualize a map feature but can be a little complicated to add. In this example we will use US States data from the `spData` package and the `cartography` package to show how you can add hatching to a map.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# spData makes the us_states data frame available. \nlibrary(spData)\n# sf is needed to read the geometry in the us_states data frame which is an sf object. \nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLinking to GEOS 3.10.2, GDAL 3.4.2, PROJ 8.2.1; sf_use_s2() is TRUE\n```\n:::\n\n```{.r .cell-code}\n# cartography allows you to add the hatched and choropleth map layers. \nlibrary(cartography)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nThis project is in maintenance mode. \nCore functionalities of `cartography` can be found in `mapsf`.\nhttps://riatelab.github.io/mapsf/\n```\n:::\n\n```{.r .cell-code}\n# adds functionality the helps us rearrange the data and is generally wonderful. \nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages\n───────────────────────────────────────\ntidyverse 1.3.2 ──\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n✔ ggplot2 3.3.6      ✔ purrr   0.3.4 \n✔ tibble  3.1.8      ✔ dplyr   1.0.10\n✔ tidyr   1.2.1      ✔ stringr 1.4.1 \n✔ readr   2.1.2      ✔ forcats 0.5.2 \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n:::\n\n\nLets visualize population growth in the United States between 2010 and 2015 with a hatched feature showing states that experienced negative growth.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Use mutate from the tidyverse to create a new variable for population growth called pop_growth.\nus_states_diff <- us_states |> \n  mutate(\"pop_growth\" = total_pop_15 - total_pop_10)\n```\n:::\n\n\nIn order to add the hatched layer we will need a data frame with only the polygons that will be hatched. We can use the tidyverse to accomplish this.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Creates a data frame with only polygons of states that had negative population growth. \nhatched_df <- us_states_diff |> \n  select(pop_growth) |> \n  filter(pop_growth < 0)\n```\n:::\n\n\nThe `cartography` package creates layers that can be plotted using `plot` from base r. This requires that we create a base plot and add all of the layers we want in one code chunk. Here is a quick preview of what we will do below:\n- Create a base plot.\n- Create and add a choropleth layer of population growth.\n- Create and add a hatched layer of showing states with negative population growth. \n- Add a legend\n- Set layout options. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Creates the base plot that all the following layers will be plotted on top of. \nplot(us_states$geometry)\n\n###############################\n####Choropleth Layers##########\n###############################\n\n# Creates and add the choropleth layer to the base plot\nchoroLayer(\n  # specify the data.\n  x = us_states_diff,\n  # specify the variable to be plotted.\n  var = \"pop_growth\",\n  # specify the method of creating breaks.\n  method = \"jenks\",\n  # specify the number of classes.\n  nclass = 5,\n  # sepecify the color palette, these need to be in the order you want them to appear.\n  col = c(\"#cce7c9\",\"#8bca84\",\"#5bb450\",\"#46923c\",\"#276221\"),\n  # specify border color.\n  border = \"black\",\n  # specify line weight.\n  lwd = 0.5,\n  # sets legend position.\n  legend.pos = \"bottomright\",\n  # sets legend title size.\n  legend.title.cex = 0.5,\n  # sets legend values size.\n  legend.values.cex = 0.5,\n  # sets legend title.\n  legend.title.txt = \"Population \\nGrowth\",\n  # adds a frame to the legend.\n  legend.frame = TRUE,\n  # adds this layer to the previous plot.\n  add = TRUE)\n\n# This layer is purely aesthetic and makes it so that the map of United States apears on top of the legend created in the previous layer. \nchoroLayer(\n  x = us_states_diff,\n  var = \"pop_growth\",\n  method = \"jenks\",\n  nclass = 5,\n  col = c(\"#cce7c9\",\"#8bca84\",\"#5bb450\",\"#46923c\",\"#276221\"),\n  border = \"black\",\n  lwd = 0.5,\n  legend.pos = \"n\",\n  add = TRUE)\n\n###############################\n###HATCHED LAYER###############\n###############################\n\n# Creates the hatched layer and adds it to the plot.  \nhatchedLayer(\n  # the data to be plotted, this is the data frame we created earlier of only the states to the hatched. \n  x = hatched_df,\n  # sets the pattern\n  pattern = \"diamond\",\n  # sets the densiry of the pattern,. \n  density = 4,\n  # sets the line weight. \n  lwd = 0.3,\n  # adds the layer to the previous plot. \n  add = TRUE)\n\n#########################################\n######Hatched Legend#####################\n#########################################\n\n# Creates a legend for the hatched layer. This will not be part of the choropleth legend. \nlegendHatched(pos = \"bottomleft\",\n              title.txt = \"\",\n              categ = \"States with Negative Population Growth\",\n              patterns = \"diamond\",\n              density = 1,\n              col = \"black\",\n              ptrn.bg = \"white\")\n\n###############################\n#######Layout options##########\n###############################\n# Creates a layout layer for displaying the map. \nlayoutLayer(title = \"Population Growth in the United States\",\n            frame = TRUE,\n            scale = FALSE\n             )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}